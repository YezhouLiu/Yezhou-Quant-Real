import pandas as pd


# ----------------------------------------------------------------------------------------------------------------------------------------
# 对 DataFrame 每列进行 z-score 标准化，忽略 NaN
# 等价于 scipy.stats.zscore(df, nan_policy="omit", axis=0)
# ----------------------------------------------------------------------------------------------------------------------------------------
def zscore_df(df: pd.DataFrame) -> pd.DataFrame:
    return (df - df.mean()) / df.std(ddof=0)


# ----------------------------------------------------------------------------------------------------------------------------------------
# 对一个 pandas Series 进行标准化（减去均值除以标准差），保留 NaN
# ----------------------------------------------------------------------------------------------------------------------------------------
def zscore_series(series: pd.Series) -> pd.Series:
    mean = series.mean()
    std = series.std()
    if std == 0 or pd.isna(std):
        return pd.Series([0] * len(series), index=series.index)
    return (series - mean) / std
